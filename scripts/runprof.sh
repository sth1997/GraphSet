#!/bin/bash
<< comment
comments
comment

all_metrics="inst_per_warp,branch_efficiency,warp_execution_efficiency,warp_nonpred_execution_efficiency,inst_replay_overhead,shared_load_transactions_per_request,shared_store_transactions_per_request,local_load_transactions_per_request,local_store_transactions_per_request,gld_transactions_per_request,gst_transactions_per_request,shared_store_transactions,shared_load_transactions,local_load_transactions,local_store_transactions,gld_transactions,gst_transactions,sysmem_read_transactions,sysmem_write_transactions,l2_read_transactions,l2_write_transactions,dram_read_transactions,dram_write_transactions,global_hit_rate,local_hit_rate,gld_requested_throughput,gst_requested_throughput,gld_throughput,gst_throughput,local_memory_overhead,tex_cache_hit_rate,l2_tex_read_hit_rate,l2_tex_write_hit_rate,dram_read_throughput,dram_write_throughput,tex_cache_throughput,l2_tex_read_throughput,l2_tex_write_throughput,l2_read_throughput,l2_write_throughput,sysmem_read_throughput,sysmem_write_throughput,local_load_throughput,local_store_throughput,shared_load_throughput,shared_store_throughput,gld_efficiency,gst_efficiency,tex_cache_transactions,flop_count_dp,flop_count_dp_add,flop_count_dp_fma,flop_count_dp_mul,flop_count_sp,flop_count_sp_add,flop_count_sp_fma,flop_count_sp_mul,flop_count_sp_special,inst_executed,inst_issued,dram_utilization,sysmem_utilization,stall_inst_fetch,stall_exec_dependency,stall_memory_dependency,stall_texture,stall_sync,stall_other,stall_constant_memory_dependency,stall_pipe_busy,shared_efficiency,inst_fp_32,inst_fp_64,inst_integer,inst_bit_convert,inst_control,inst_compute_ld_st,inst_misc,inst_inter_thread_communication,issue_slots,cf_issued,cf_executed,ldst_issued,ldst_executed,atomic_transactions,atomic_transactions_per_request,l2_atomic_throughput,l2_atomic_transactions,l2_tex_read_transactions,stall_memory_throttle,stall_not_selected,l2_tex_write_transactions,flop_count_hp,flop_count_hp_add,flop_count_hp_mul,flop_count_hp_fma,inst_fp_16,ipc,issued_ipc,issue_slot_utilization,sm_efficiency,achieved_occupancy,eligible_warps_per_cycle,shared_utilization,l2_utilization,tex_utilization,ldst_fu_utilization,cf_fu_utilization,tex_fu_utilization,special_fu_utilization,half_precision_fu_utilization,single_precision_fu_utilization,double_precision_fu_utilization,flop_hp_efficiency,flop_sp_efficiency,flop_dp_efficiency,sysmem_read_utilization,sysmem_write_utilization,stall_sleeping,pcie_total_data_transmitted,pcie_total_data_received,inst_executed_global_loads,inst_executed_local_loads,inst_executed_shared_loads,inst_executed_surface_loads,inst_executed_global_stores,inst_executed_local_stores,inst_executed_shared_stores,inst_executed_surface_stores,inst_executed_global_atomics,inst_executed_global_reductions,inst_executed_surface_atomics,inst_executed_surface_reductions,inst_executed_shared_atomics,inst_executed_tex_ops,dram_read_bytes,dram_write_bytes,global_load_requests,local_load_requests,surface_load_requests,global_store_requests,local_store_requests,surface_store_requests,global_atomic_requests,global_reduction_requests,surface_atomic_requests,surface_reduction_requests,l2_global_load_bytes,l2_local_load_bytes,l2_surface_load_bytes,l2_global_atomic_store_bytes,l2_local_global_store_bytes,l2_surface_store_bytes,sysmem_read_bytes,sysmem_write_bytes,l2_tex_hit_rate,texture_load_requests,tensor_precision_fu_utilization"
metrics="inst_per_warp,warp_execution_efficiency,warp_nonpred_execution_efficiency,shared_efficiency,gld_throughput,gld_requested_throughput,sm_efficiency,eligible_warps_per_cycle,achieved_occupancy,ipc,tex_cache_hit_rate"

nvprof --metrics ${metrics} bin/gpu_graph MiCo ~zms/mico_input
nvprof --metrics ${metrics} bin/gpu_graph_old MiCo ~zms/mico_input
